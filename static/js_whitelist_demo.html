<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSç™½åå•è¿½è¸ª - ä½¿ç”¨ç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        .code-block {
            background: #f4f4f4;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .info-box {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        .feature-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
            font-size: 18px;
        }
        .step {
            background: #f9f9f9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #2196F3;
        }
        .step-number {
            background: #2196F3;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” JSç™½åå•è¿½è¸ªåŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹</h1>
        
        <div class="info-box">
            <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong> JSç™½åå•è¿½è¸ªåŠŸèƒ½å…è®¸ä½ æ§åˆ¶å“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®ç‰¹å®šçš„JavaScriptæ–‡ä»¶ã€‚
            åŸºäºç”¨æˆ·çš„IPå’ŒUser-Agentè¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯ä¼šè‡ªåŠ¨ä»æœåŠ¡å™¨è¯·æ±‚ä¸­è·å–ï¼Œæ— éœ€åœ¨JSä¸­ä¼ è¾“ã€‚
        </div>

        <h2>ğŸ“‹ åŠŸèƒ½ç‰¹æ€§</h2>
        <ul class="feature-list">
            <li>è‡ªåŠ¨ä»è¯·æ±‚ä¸­è·å–UAå’ŒIPï¼Œæ— éœ€JSä¼ è¾“</li>
            <li>æ”¯æŒå¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼ˆdefer/asyncï¼‰</li>
            <li>å¯åœ¨config.pyä¸­å®Œå…¨å¼€å¯/å…³é—­</li>
            <li>é…ç½®åŒ–TTLç®¡ç†ï¼ˆé»˜è®¤60åˆ†é’Ÿï¼‰</li>
            <li>åŒé‡è®¤è¯æ–¹å¼ï¼šAPI Keyï¼ˆåç«¯ï¼‰+ HMACç­¾åï¼ˆå‰ç«¯ï¼‰</li>
            <li>ç‹¬ç«‹çš„ç­¾åå¯†é’¥é…ç½®ï¼Œç­¾åæœ‰æ•ˆæœŸ1å°æ—¶</li>
            <li>æä¾›å®Œæ•´çš„APIç”¨äºç®¡ç†ç™½åå•</li>
        </ul>

        <h2>âš™ï¸ é…ç½®è¯´æ˜</h2>
        <p>åœ¨ <code>models/config.py</code> ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
        <div class="code-block">
# JSç™½åå•è¿½è¸ªåŠŸèƒ½é…ç½®<br>
ENABLE_JS_WHITELIST_TRACKER = True  # æ˜¯å¦å¯ç”¨JSç™½åå•è¿½è¸ªåŠŸèƒ½<br>
JS_WHITELIST_TRACKER_TTL = 60 * 60  # JSè®¿é—®è¿½è¸ªè®°å½•TTLï¼ˆç§’ï¼‰ï¼Œé»˜è®¤60åˆ†é’Ÿ<br>
JS_WHITELIST_SECRET_KEY = b"js_whitelist_secret_key_change_this"  # JSç™½åå•HMACç­¾åå¯†é’¥ï¼ˆç‹¬ç«‹é…ç½®ï¼‰<br>
JS_WHITELIST_SIGNATURE_TTL = 60 * 60  # JSç™½åå•ç­¾åæœ‰æ•ˆæœŸï¼ˆç§’ï¼‰ï¼Œé»˜è®¤1å°æ—¶
        </div>

        <h2>ğŸš€ ä½¿ç”¨æ­¥éª¤</h2>
        
        <div class="step">
            <span class="step-number">1A</span>
            <strong>æ–¹å¼1: åç«¯æœåŠ¡å™¨æ·»åŠ ï¼ˆä½¿ç”¨API Keyï¼‰</strong>
            <div class="code-block" style="margin-top: 10px;">
POST http://your-server:7889/api/js-whitelist<br>
Headers:<br>
&nbsp;&nbsp;Authorization: Bearer F2UkWEJZRBxC7<br>
&nbsp;&nbsp;Content-Type: application/json<br>
Body:<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;"uid": "user123",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"jsPath": "static/js/app.js"<br>
&nbsp;&nbsp;}
            </div>
            <div class="warning-box" style="margin-top: 10px;">
                <strong>æ³¨æ„ï¼š</strong> æ­¤æ–¹å¼é€‚åˆåç«¯æœåŠ¡å™¨è°ƒç”¨ï¼Œä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²API Keyï¼
            </div>
        </div>

        <div class="step">
            <span class="step-number">1B</span>
            <strong>æ–¹å¼2: å‰ç«¯å®‰å…¨è°ƒç”¨ï¼ˆä½¿ç”¨HMACç­¾åï¼‰</strong>
            <div class="code-block" style="margin-top: 10px;">
GET/POST http://your-server:7889/api/js-whitelist?uid=user123&js_path=static/js/app.js&expires=1234567890&sign=abc123...<br>
<br>
ç­¾åç”Ÿæˆï¼ˆåœ¨åç«¯æœåŠ¡å™¨ä¸Šï¼‰:<br>
&nbsp;&nbsp;message = "uid:js_path:expires"<br>
&nbsp;&nbsp;signature = HMAC-SHA256(SECRET_KEY, message)<br>
<br>
æ”¯æŒGETå’ŒPOSTä¸¤ç§æ–¹æ³•ï¼ŒGETæ–¹æ³•å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è®¿é—®
            </div>
            <div class="info-box" style="margin-top: 10px;">
                <strong>æ¨èï¼š</strong> å‰ç«¯è°ƒç”¨æ—¶ï¼Œå…ˆè¯·æ±‚åç«¯ç”Ÿæˆç­¾åï¼Œç„¶åä½¿ç”¨ç­¾åè°ƒç”¨FileProxyã€‚GETæ–¹æ³•æ›´ç®€å•ï¼Œå¯ä»¥ç›´æ¥è®¿é—®URLï¼
            </div>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>åœ¨HTMLé¡µé¢ä¸­å¼•ç”¨JSæ–‡ä»¶</strong>
            <div class="code-block" style="margin-top: 10px;">
&lt;!-- æ–¹å¼1: ä½¿ç”¨deferå¼‚æ­¥åŠ è½½ï¼ˆæ¨èï¼‰ --&gt;<br>
&lt;script defer src="http://your-server:7889/static/js/app.js"&gt;&lt;/script&gt;<br>
<br>
&lt;!-- æ–¹å¼2: ä½¿ç”¨asyncå¼‚æ­¥åŠ è½½ --&gt;<br>
&lt;script async src="http://your-server:7889/static/js/utils.js"&gt;&lt;/script&gt;<br>
<br>
&lt;!-- æ–¹å¼3: æ™®é€šåŒæ­¥åŠ è½½ --&gt;<br>
&lt;script src="http://your-server:7889/static/js/main.js"&gt;&lt;/script&gt;
            </div>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>è®¿é—®æµç¨‹è¯´æ˜</strong>
            <ul style="margin-top: 10px;">
                <li>ç”¨æˆ·æµè§ˆå™¨è®¿é—®HTMLé¡µé¢</li>
                <li>æµè§ˆå™¨è§£æåˆ°&lt;script&gt;æ ‡ç­¾ï¼Œå‘èµ·JSæ–‡ä»¶è¯·æ±‚</li>
                <li>FileProxyæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œè‡ªåŠ¨æå–UAå’ŒIP</li>
                <li>éªŒè¯UA+IPæ˜¯å¦åœ¨ç™½åå•ä¸­</li>
                <li>å¦‚æœåœ¨ç™½åå•ä¸­ â†’ è¿”å›JSæ–‡ä»¶å†…å®¹</li>
                <li>å¦‚æœä¸åœ¨ç™½åå•ä¸­ â†’ è¿”å›403 Forbidden</li>
            </ul>
        </div>

        <h2>ğŸ” APIç«¯ç‚¹è¯´æ˜</h2>
        
        <h3>1. æ·»åŠ JSç™½åå•ï¼ˆåŒé‡è®¤è¯ï¼‰</h3>
        <div class="code-block">
POST /api/js-whitelist<br>
<br>
æ–¹å¼A - API Keyï¼ˆåç«¯æœåŠ¡å™¨ï¼‰:<br>
&nbsp;&nbsp;Header: Authorization: Bearer {API_KEY}<br>
&nbsp;&nbsp;Body: {"uid": "ç”¨æˆ·ID", "jsPath": "JSæ–‡ä»¶è·¯å¾„"}<br>
<br>
æ–¹å¼B - HMACç­¾åï¼ˆå‰ç«¯å®‰å…¨ï¼‰:<br>
&nbsp;&nbsp;Query: ?uid=ç”¨æˆ·ID&js_path=JSè·¯å¾„&expires=è¿‡æœŸæ—¶é—´&sign=ç­¾å<br>
&nbsp;&nbsp;ç­¾å = HMAC-SHA256(SECRET_KEY, "uid:js_path:expires")
        </div>

        <h3>2. æ£€æŸ¥ç™½åå•</h3>
        <div class="code-block">
GET /api/js-whitelist/check?js_path=è·¯å¾„&uid=ç”¨æˆ·ID<br>
æ— éœ€è®¤è¯ï¼Œè‡ªåŠ¨ä½¿ç”¨è¯·æ±‚çš„UA+IPéªŒè¯
        </div>

        <h3>3. æŸ¥çœ‹ç»Ÿè®¡</h3>
        <div class="code-block">
GET /api/js-whitelist/stats?uid=ç”¨æˆ·ID<br>
éœ€è¦API Keyè®¤è¯
        </div>

        <h2>ğŸ’¡ defer vs async vs æ™®é€šåŠ è½½</h2>
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <tr style="background: #f4f4f4;">
                <th style="padding: 10px; border: 1px solid #ddd;">åŠ è½½æ–¹å¼</th>
                <th style="padding: 10px; border: 1px solid #ddd;">ç‰¹ç‚¹</th>
                <th style="padding: 10px; border: 1px solid #ddd;">æ¨èåœºæ™¯</th>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>defer</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd;">å¼‚æ­¥åŠ è½½ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸é˜»å¡é¡µé¢è§£æ</td>
                <td style="padding: 10px; border: 1px solid #ddd;">éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œçš„è„šæœ¬</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>async</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd;">å¼‚æ­¥åŠ è½½ï¼ŒåŠ è½½å®Œç«‹å³æ‰§è¡Œï¼Œå¯èƒ½ä¹±åº</td>
                <td style="padding: 10px; border: 1px solid #ddd;">ç‹¬ç«‹çš„å·¥å…·è„šæœ¬ï¼ˆå¦‚ç»Ÿè®¡ä»£ç ï¼‰</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>æ™®é€š</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd;">åŒæ­¥åŠ è½½ï¼Œä¼šé˜»å¡é¡µé¢è§£æ</td>
                <td style="padding: 10px; border: 1px solid #ddd;">å…³é”®è„šæœ¬ï¼Œå¿…é¡»ç«‹å³æ‰§è¡Œ</td>
            </tr>
        </table>

        <h2>ğŸ“ Pythonè°ƒç”¨ç¤ºä¾‹</h2>
        <div class="code-block">
import requests<br>
<br>
# æ·»åŠ JSæ–‡ä»¶åˆ°ç™½åå•<br>
response = requests.post(<br>
&nbsp;&nbsp;'http://localhost:7889/api/js-whitelist',<br>
&nbsp;&nbsp;headers={<br>
&nbsp;&nbsp;&nbsp;&nbsp;'Authorization': 'Bearer F2UkWEJZRBxC7',<br>
&nbsp;&nbsp;&nbsp;&nbsp;'Content-Type': 'application/json'<br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;json={<br>
&nbsp;&nbsp;&nbsp;&nbsp;'uid': 'user123',<br>
&nbsp;&nbsp;&nbsp;&nbsp;'jsPath': 'static/js/app.js'<br>
&nbsp;&nbsp;}<br>
)<br>
<br>
print(response.json())
        </div>

        <h2>ğŸ”— ç›¸å…³é“¾æ¥</h2>
        <ul>
            <li><a href="/docs" target="_blank">APIæ–‡æ¡£</a></li>
            <li><a href="/monitor" target="_blank">ç›‘æ§é¢æ¿</a></li>
            <li><a href="https://github.com/e54385991/YuemPyScripts" target="_blank">é¡¹ç›®ä»“åº“</a></li>
        </ul>

        <div class="info-box" style="margin-top: 30px;">
            <strong>æç¤ºï¼š</strong> å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹è¯·å‚è€ƒ <code>examples/js_whitelist_example.py</code> æ–‡ä»¶ã€‚
        </div>
    </div>

    <!-- æ¼”ç¤ºï¼šä½¿ç”¨deferåŠ è½½è„šæœ¬ï¼ˆå¦‚æœJSæ–‡ä»¶å­˜åœ¨ä¸”åœ¨ç™½åå•ä¸­ï¼‰ -->
    <!-- <script defer src="/static/js/demo.js"></script> -->
</body>
</html>
