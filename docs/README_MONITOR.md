# 文件代理服务器 - Web监控面板

## 概述

Web监控面板为文件代理服务器提供实时的可视化监控界面，可以查看系统状态、性能指标和流量统计。

## 功能特性

### 📊 实时监控
- **系统健康状态**：实时显示服务器运行状态
- **Redis性能**：监控Redis连接状态和响应延迟
- **活跃连接**：显示当前活跃会话和用户数量
- **流量统计**：实时流量收集和分析

### 📈 性能图表
- **Redis延迟趋势图**：显示最近20次的Redis响应时间
- **活跃连接趋势图**：跟踪会话和用户数量变化

### 🔍 详细信息面板
- Redis连接信息
- HTTP客户端状态
- 流量收集器状态
- 系统信息（PID、时间戳等）
- 性能配置（流式传输、并行验证等）
- 优化状态（uvloop、性能优化器等）

## 访问方式

### 本地开发环境
```
http://localhost:7888/monitor
```

### 生产环境
```
http://your-server-ip:port/monitor
```

## 端点说明

### 监控面板
- **GET /monitor** - Web监控面板主页面

### API端点
- **GET /health** - 健康检查，返回系统状态
- **GET /stats** - 性能统计，返回详细指标
- **GET /traffic** - 流量统计信息

### 静态资源
- **GET /static/{path}** - 服务静态文件（CSS、JS、图片等）

## 自动刷新

监控面板每30秒自动刷新一次数据，确保信息实时更新。也可以手动点击"🔄 刷新数据"按钮立即更新。

## 监控指标说明

### 系统状态
- **健康/异常**：绿色表示系统正常，红色表示异常

### Redis延迟
- **<10ms**：优秀
- **10-50ms**：良好
- **50-100ms**：一般
- **>100ms**：需要优化

### 活跃连接
- **活跃会话**：当前有效的用户会话数
- **活跃用户**：当前在线的独立用户数
- **M3U8访问**：当前活跃的M3U8请求数
- **IP访问记录**：白名单中的IP记录数

## 技术栈

- **前端框架**：原生JavaScript
- **图表库**：Chart.js 4.4.0
- **样式**：CSS3 + 渐变动画
- **数据获取**：Fetch API
- **实时更新**：定时轮询（30秒）

## 浏览器兼容性

- Chrome/Edge: ✅ 完全支持
- Firefox: ✅ 完全支持
- Safari: ✅ 完全支持
- IE11: ❌ 不支持

## 响应式设计

监控面板采用响应式设计，支持各种屏幕尺寸：
- 桌面端（>1200px）：完整布局
- 平板端（768px-1200px）：自适应布局
- 移动端（<768px）：紧凑布局

## 性能考虑

1. **轻量级**：纯静态HTML+CSS+JS，无需额外服务
2. **按需加载**：图表库从CDN加载
3. **最小化请求**：合并CSS和JS文件
4. **缓存友好**：静态资源可以被浏览器缓存

## 自定义配置

### 修改刷新间隔
编辑 `static/js/monitor.js`：
```javascript
// 将30000改为你想要的毫秒数（例如：60000 = 1分钟）
setInterval(refreshData, 30000);
```

### 修改图表历史长度
编辑 `static/js/monitor.js`：
```javascript
// 修改最大历史记录数
const maxHistoryLength = 20; // 改为你想要的数量
```

### 自定义样式
编辑 `static/css/monitor.css`：
```css
:root {
    --primary-color: #667eea;  /* 主色调 */
    --secondary-color: #764ba2; /* 辅助色 */
    /* ... 其他颜色变量 */
}
```

## 故障排查

### 监控面板无法加载
1. 检查static目录是否存在
2. 确认monitor.html文件存在于static目录
3. 检查文件权限

### 数据无法更新
1. 检查 `/health` 和 `/stats` 端点是否可访问
2. 查看浏览器控制台是否有错误
3. 确认CORS配置正确

### 图表不显示
1. 确认Chart.js CDN可访问
2. 检查浏览器JavaScript是否启用
3. 查看浏览器控制台错误信息

## 安全建议

1. **生产环境**：建议在监控面板前添加认证
2. **访问控制**：使用防火墙限制监控端口访问
3. **HTTPS**：在生产环境使用HTTPS
4. **敏感信息**：不在监控面板显示密钥等敏感信息

## 开发说明

### 添加新的监控指标

1. 在 `app.py` 的 `/stats` 端点添加新指标
2. 在 `monitor.js` 的 `updateUI` 函数中处理新数据
3. 在 `monitor.html` 添加显示元素
4. 在 `monitor.css` 添加样式（如需要）

### 添加新的图表

1. 在 `monitor.html` 添加新的 canvas 元素
2. 在 `monitor.js` 的 `initCharts` 函数中初始化新图表
3. 在 `updateCharts` 函数中更新图表数据

## 更新日志

### v2.0.0 (2025-10-31)
- ✨ 新增Web监控面板
- 📊 添加实时性能图表
- 🎨 响应式UI设计
- ⚡ 自动数据刷新
- 📈 多维度监控指标

## 许可证

与主项目保持一致
